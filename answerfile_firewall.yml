nsxt_ip_sets:
- display_name: 'ips-fw-testing'
  ip_addresses:
  - '192.168.0.0/24'
  - '192.168.1.1'
  state: present

nsxt_ns_groups:
- display_name: 'ns-fw-testing'
  members:
    - resource_type: NSGroupSimpleExpression
      target_property: id
      op: EQUALS
      target_type: IPSet
      value: 'ips-fw-testing'
  state: present
- display_name: 'ns-fw-testing_criteria'
  membership_criteria:
    - resource_type: NSGroupTagExpression
      target_type: 'LogicalSwitch'
      scope: 'S1'
      tag: 'T1'
    - resource_type: NSGroupComplexExpression
      expressions:
        - resource_type: NSGroupTagExpression
          target_type: 'LogicalPort'
          scope: 'S2'
          tag: 'T2'
        - resource_type: NSGroupTagExpression
          target_type: 'LogicalPort'
          scope: '99'
          tag: 'T1'
  state: present

nsxt_dfw_section_with_rules:
- display_name: Test Section DFW
  description: Testing
  modify_placement: True
  stateful: True
  state: present
  applied_tos:
  - target_display_name: 'ns-fw-testing'
    target_type: NSGroup
  - target_display_name: 'lp-fw-testing'
    target_type: LogicalPort
  - target_display_name: 'ls-fw-testing'
    target_type: LogicalSwitch
  section_placement:
    operation: insert_before
    display_name: "Default Layer3 Section"
  rules:
  - display_name: 'Test Rule DFW'
    description: Testing
    action: ALLOW
    applied_tos:
    - target_display_name: 'ls-fw-testing'
      target_type: LogicalSwitch
    context_profiles:
    - target_display_name: 'ACTIVDIR'
      target_type: NSProfile
    destinations:
    - target_display_name: 'ips-fw-testing' # Will insert target_id a runtime
      target_type: IPSet
    direction: IN_OUT
    disabled: False
    ip_protocol: IPV4_IPV6
    logged: True
    notes: 'Test rule to prove FW rules'
    resource_type: FirewallRule
    rule_tag: Test-Log-Tag
    services: 
    - target_display_name: 'Active Directory Server UDP' # Will insert target_id a runtime
      target_type: NSService
    sources: 
    - target_display_name: 'ns-fw-testing' # Will insert target_id a runtime
      target_type: NSGroup

- display_name: Test Section Edge
  description: Testing edge1
  modify_placement: False
  stateful: True
  state: present
  tags:
  - scope: 'test scope'
    tag: 'test tag'
  applied_tos:
  - target_display_name: 't1-fw-testing'
    target_type: LogicalRouter
  section_placement:
    operation: insert_bottom
  rules:
  - display_name: 'Test Rule Edge'
    description: Testing
    action: ALLOW
    applied_tos:
    - target_display_name: 'lrp-fw-testing'
      target_type: LogicalRouterPort
    destinations: 
    - target_display_name: 'ips-fw-testing'
      target_type: IPSet
    direction: IN_OUT
    disabled: False
    ip_protocol: IPV4
    logged: True
    resource_type: FirewallRule
    services: 
    - target_display_name: 'SSH' # Will insert target_id a runtime
      target_type: NSService
    sources: 
    - target_display_name: '10.1.1.1'
      target_type: IPAddress


services:
- display_name: 'HTTPS-ALT'
  description: random
  nsservice_element:
    destination_ports:
    - '8443'
    l4_protocol: TCP
    resource_type: L4PortSetNSService
  tags:
  - scope: 'test scope'
    tag: 'test tag'